# API Contract: Todo Management Service

## Overview
RESTful API for managing user-specific todos with JWT-based authentication. All endpoints require valid JWT tokens issued by Better Auth.

## Base URL
`http://localhost:8000/api/` (development)
`https://[production-domain]/api/` (production)

## Authentication
All endpoints (except health check) require JWT authentication via Authorization header.

### Header Format
```
Authorization: Bearer <jwt_token>
```

### JWT Verification
- Token must be signed with BETTER_AUTH_SECRET
- Token must not be expired
- User ID extracted from `sub` claim for data isolation

## Common Responses

### Success Response
```json
{
  "success": true,
  "data": { /* response data */ }
}
```

### Error Response
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error message"
  }
}
```

## Endpoints

### Health Check
**GET** `/health`

#### Description
Check if the API is operational.

#### Response
**Success (200)**:
```json
{
  "status": "healthy",
  "timestamp": "2026-01-08T10:00:00Z"
}
```

### Get All Todos
**GET** `/todos`

#### Description
Retrieve all todos for the authenticated user.

#### Headers
- `Authorization: Bearer <jwt_token>` (Required)

#### Query Parameters
- `completed` (optional): Filter by completion status (true/false)
- `limit` (optional): Limit number of results (default: 50, max: 100)
- `offset` (optional): Offset for pagination (default: 0)

#### Response
**Success (200)**:
```json
{
  "todos": [
    {
      "id": 1,
      "user_id": "user_abc123",
      "title": "Complete project",
      "description": "Finish the backend implementation",
      "completed": false,
      "created_at": "2026-01-08T09:00:00Z",
      "updated_at": "2026-01-08T09:00:00Z"
    }
  ]
}
```

**Unauthorized (401)**:
```json
{
  "detail": "Not authenticated"
}
```

### Create Todo
**POST** `/todos`

#### Description
Create a new todo for the authenticated user.

#### Headers
- `Authorization: Bearer <jwt_token>` (Required)

#### Request Body
```json
{
  "title": "string (1-255 chars)",
  "description": "string (optional, 0-1000 chars)"
}
```

#### Response
**Success (201)**:
```json
{
  "id": 1,
  "user_id": "user_abc123",
  "title": "Complete project",
  "description": "Finish the backend implementation",
  "completed": false,
  "created_at": "2026-01-08T09:00:00Z",
  "updated_at": "2026-01-08T09:00:00Z"
}
```

**Validation Error (422)**:
```json
{
  "detail": [
    {
      "loc": ["body", "title"],
      "msg": "Field required",
      "type": "value_error.missing"
    }
  ]
}
```

### Get Todo by ID
**GET** `/todos/{id}`

#### Description
Retrieve a specific todo by ID for the authenticated user.

#### Path Parameters
- `id` (integer): Todo ID

#### Headers
- `Authorization: Bearer <jwt_token>` (Required)

#### Response
**Success (200)**:
```json
{
  "id": 1,
  "user_id": "user_abc123",
  "title": "Complete project",
  "description": "Finish the backend implementation",
  "completed": false,
  "created_at": "2026-01-08T09:00:00Z",
  "updated_at": "2026-01-08T09:00:00Z"
}
```

**Not Found (404)**:
```json
{
  "detail": "Todo not found"
}
```

**Unauthorized (401)**:
```json
{
  "detail": "Not authenticated"
}
```

**Forbidden (403)**:
```json
{
  "detail": "Access denied - not owner of this todo"
}
```

### Update Todo
**PUT** `/todos/{id}`

#### Description
Update an existing todo for the authenticated user.

#### Path Parameters
- `id` (integer): Todo ID

#### Headers
- `Authorization: Bearer <jwt_token>` (Required)

#### Request Body
```json
{
  "title": "string (1-255 chars)",
  "description": "string (optional, 0-1000 chars)",
  "completed": boolean
}
```

#### Response
**Success (200)**:
```json
{
  "id": 1,
  "user_id": "user_abc123",
  "title": "Updated title",
  "description": "Updated description",
  "completed": true,
  "created_at": "2026-01-08T09:00:00Z",
  "updated_at": "2026-01-08T10:00:00Z"
}
```

### Delete Todo
**DELETE** `/todos/{id}`

#### Description
Delete a specific todo for the authenticated user.

#### Path Parameters
- `id` (integer): Todo ID

#### Headers
- `Authorization: Bearer <jwt_token>` (Required)

#### Response
**Success (200)**:
```json
{
  "success": true
}
```

### Toggle Todo Completion
**PATCH** `/todos/{id}/toggle`

#### Description
Toggle the completion status of a specific todo for the authenticated user.

#### Path Parameters
- `id` (integer): Todo ID

#### Headers
- `Authorization: Bearer <jwt_token>` (Required)

#### Response
**Success (200)**:
```json
{
  "id": 1,
  "completed": true,
  "updated_at": "2026-01-08T10:00:00Z"
}
```

## Error Codes

| HTTP Code | Error Code | Description |
|-----------|------------|-------------|
| 401 | UNAUTHORIZED | Invalid or missing JWT token |
| 403 | FORBIDDEN | User does not own the requested resource |
| 404 | NOT_FOUND | Requested resource does not exist |
| 422 | VALIDATION_ERROR | Request data validation failed |
| 500 | INTERNAL_ERROR | Server-side error occurred |

## Rate Limits
- 1000 requests per hour per user
- 100 requests per minute per IP (unauthenticated)